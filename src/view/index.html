<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Materiais de Enfermagem</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-1px);
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .status-vencido { background-color: #fee2e2; color: #dc2626; }
        .status-vencendo { background-color: #fef3c7; color: #d97706; }
        .status-ok { background-color: #dcfce7; color: #16a34a; }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gray-50"><!-- Tela de Login -->
  <div id="loginScreen" class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
   <div class="max-w-md w-full space-y-8">
    <div class="text-center">
     <div class="mx-auto h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center mb-4">
      <svg class="h-8 w-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
      </svg>
     </div>
     <h2 id="loginTitle" class="text-3xl font-bold text-gray-900">Sistema de Materiais de Enfermagem</h2>
     <p class="mt-2 text-gray-600">Entre com seu nome para acessar o sistema</p>
    </div>
    <form id="loginForm" class="mt-8 space-y-6">
     <div><label for="nomeUsuario" class="block text-lg font-medium text-gray-700 mb-2">Seu Nome Completo</label> <input id="nomeUsuario" name="nomeUsuario" type="text" required class="appearance-none rounded-lg relative block w-full px-4 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg" placeholder="Digite seu nome completo">
     </div>
     <div><button type="submit" class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-lg font-medium rounded-lg text-white btn-primary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"> Entrar no Sistema </button>
     </div>
    </form>
   </div>
  </div><!-- Sistema Principal -->
  <div id="mainSystem" class="hidden min-h-full"><!-- Header -->
   <header class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex justify-between items-center py-4">
      <div class="flex items-center">
       <div class="h-10 w-10 bg-blue-600 rounded-lg flex items-center justify-center mr-3">
        <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
       </div>
       <div>
        <h1 id="systemTitle" class="text-xl font-bold text-gray-900">Sistema de Materiais de Enfermagem</h1>
        <p id="hospitalName" class="text-sm text-gray-600">Hospital/Clínica</p>
       </div>
      </div>
      <div class="flex items-center space-x-4"><span class="text-sm text-gray-600">Usuário: <span id="currentUser" class="font-medium"></span></span> <button id="logoutBtn" class="text-sm text-red-600 hover:text-red-800 font-medium">Sair</button>
      </div>
     </div>
    </div>
   </header><!-- Conteúdo Principal -->
   <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8"><!-- Botões de Ação -->
    <div class="mb-6 flex flex-wrap gap-4"><button id="addMaterialBtn" class="btn-primary text-white px-6 py-3 rounded-lg font-medium text-lg flex items-center">
      <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
      </svg> Adicionar Material </button> <button id="filterBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-medium text-lg flex items-center">
      <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.707A1 1 0 013 7V4z"></path>
      </svg> Filtrar </button>
    </div><!-- Filtros -->
    <div id="filterPanel" class="hidden mb-6 bg-white p-6 rounded-lg card-shadow">
     <h3 class="text-lg font-medium text-gray-900 mb-4">Filtros</h3>
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div><label for="filterCategoria" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label> <select id="filterCategoria" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Todas as categorias</option> </select>
      </div>
      <div><label for="filterStatus" class="block text-sm font-medium text-gray-700 mb-1">Status de Validade</label> <select id="filterStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Todos os status</option> <option value="vencido">Vencido</option> <option value="vencendo">Vencendo (30 dias)</option> <option value="ok">Dentro da validade</option> </select>
      </div>
      <div><label for="filterNome" class="block text-sm font-medium text-gray-700 mb-1">Nome do Material</label> <input type="text" id="filterNome" placeholder="Buscar por nome..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
     </div>
     <div class="mt-4 flex gap-2"><button id="applyFiltersBtn" class="btn-primary text-white px-4 py-2 rounded-lg">Aplicar Filtros</button> <button id="clearFiltersBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">Limpar</button>
     </div>
    </div><!-- Lista de Materiais -->
    <div class="bg-white rounded-lg card-shadow overflow-hidden">
     <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-lg font-medium text-gray-900">Materiais Cadastrados</h2>
      <p id="materialsCount" class="text-sm text-gray-600">0 materiais encontrados</p>
     </div>
     <div id="materialsContainer" class="divide-y divide-gray-200">
      <div id="emptyState" class="px-6 py-12 text-center">
       <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m13-8V4a1 1 0 00-1-1H7a1 1 0 00-1 1v1m8 0V4.5"></path>
       </svg>
       <h3 class="mt-2 text-lg font-medium text-gray-900">Nenhum material cadastrado</h3>
       <p class="mt-1 text-gray-500">Comece adicionando o primeiro material ao sistema.</p>
      </div>
     </div>
    </div>
   </main>
  </div><!-- Modal de Adicionar/Editar Material -->
  <div id="materialModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
   <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-lg bg-white">
    <div class="flex justify-between items-center mb-4">
     <h3 id="modalTitle" class="text-xl font-bold text-gray-900">Adicionar Material</h3><button id="closeModalBtn" class="text-gray-400 hover:text-gray-600">
      <svg class="h-6 w-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg></button>
    </div>
    <form id="materialForm" class="space-y-4">
     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div><label for="nomeMaterial" class="block text-sm font-medium text-gray-700 mb-1">Nome do Material *</label> <input type="text" id="nomeMaterial" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ex: Seringa 10ml">
      </div>
      <div><label for="categoria" class="block text-sm font-medium text-gray-700 mb-1">Categoria *</label> <select id="categoria" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Selecione uma categoria</option> <option value="Medicamentos">Medicamentos</option> <option value="Materiais Descartáveis">Materiais Descartáveis</option> <option value="Equipamentos">Equipamentos</option> <option value="Curativos">Curativos</option> <option value="Soluções">Soluções</option> <option value="Outros">Outros</option> </select>
      </div>
      <div><label for="quantidade" class="block text-sm font-medium text-gray-700 mb-1">Quantidade *</label> <input type="number" id="quantidade" required min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0">
      </div>
      <div><label for="fabricante" class="block text-sm font-medium text-gray-700 mb-1">Fabricante</label> <input type="text" id="fabricante" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nome do fabricante">
      </div>
      <div><label for="dataFabricacao" class="block text-sm font-medium text-gray-700 mb-1">Data de Fabricação</label> <input type="date" id="dataFabricacao" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
      <div><label for="dataValidade" class="block text-sm font-medium text-gray-700 mb-1">Data de Validade *</label> <input type="date" id="dataValidade" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
     </div>
     <div class="flex justify-end space-x-3 pt-4"><button type="button" id="cancelBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"> Cancelar </button> <button type="submit" id="saveBtn" class="btn-primary text-white px-6 py-2 rounded-lg"> <span id="saveBtnText">Salvar Material</span> <span id="saveBtnLoading" class="hidden">Salvando...</span> </button>
     </div>
    </form>
   </div>
  </div><!-- Modal de Confirmação de Exclusão -->
  <div id="deleteModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
   <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-lg bg-white">
    <div class="text-center">
     <svg class="mx-auto mb-4 h-12 w-12 text-red-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
     </svg>
     <h3 class="text-lg font-bold text-gray-900 mb-2">Confirmar Exclusão</h3>
     <p class="text-gray-600 mb-4">Tem certeza que deseja excluir este material? Esta ação não pode ser desfeita.</p>
     <div class="flex justify-center space-x-3"><button id="cancelDeleteBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"> Cancelar </button> <button id="confirmDeleteBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg"> <span id="deleteBtnText">Excluir</span> <span id="deleteBtnLoading" class="hidden">Excluindo...</span> </button>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Configuração padrão
        const defaultConfig = {
            sistema_titulo: "Sistema de Materiais de Enfermagem",
            hospital_nome: "Hospital/Clínica",
            background_color: "#f9fafb",
            surface_color: "#ffffff",
            text_color: "#111827",
            primary_action_color: "#3b82f6",
            secondary_action_color: "#6b7280"
        };

        // Estado da aplicação
        let currentUser = '';
        let materials = [];
        let filteredMaterials = [];
        let editingMaterial = null;
        let materialToDelete = null;

        // Elementos DOM
        const loginScreen = document.getElementById('loginScreen');
        const mainSystem = document.getElementById('mainSystem');
        const loginForm = document.getElementById('loginForm');
        const nomeUsuarioInput = document.getElementById('nomeUsuario');
        const currentUserSpan = document.getElementById('currentUser');
        const logoutBtn = document.getElementById('logoutBtn');
        const addMaterialBtn = document.getElementById('addMaterialBtn');
        const filterBtn = document.getElementById('filterBtn');
        const filterPanel = document.getElementById('filterPanel');
        const materialModal = document.getElementById('materialModal');
        const materialForm = document.getElementById('materialForm');
        const materialsContainer = document.getElementById('materialsContainer');
        const emptyState = document.getElementById('emptyState');
        const materialsCount = document.getElementById('materialsCount');
        const deleteModal = document.getElementById('deleteModal');

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                materials = data || [];
                filteredMaterials = [...materials];
                updateCategoriesFilter();
                renderMaterials();
                updateMaterialsCount();
            }
        };

        // Inicialização
        async function init() {
            // Inicializar Data SDK
            const initResult = await window.dataSdk.init(dataHandler);
            if (!initResult.isOk) {
                console.error("Erro ao inicializar Data SDK");
                return;
            }

            // Inicializar Element SDK
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        document.getElementById('loginTitle').textContent = config.sistema_titulo || defaultConfig.sistema_titulo;
                        document.getElementById('systemTitle').textContent = config.sistema_titulo || defaultConfig.sistema_titulo;
                        document.getElementById('hospitalName').textContent = config.hospital_nome || defaultConfig.hospital_nome;
                        
                        document.body.style.backgroundColor = config.background_color || defaultConfig.background_color;
                        
                        const surfaces = document.querySelectorAll('.bg-white');
                        surfaces.forEach(el => el.style.backgroundColor = config.surface_color || defaultConfig.surface_color);
                        
                        const texts = document.querySelectorAll('.text-gray-900, .text-gray-700, .text-gray-600');
                        texts.forEach(el => el.style.color = config.text_color || defaultConfig.text_color);
                        
                        const primaryBtns = document.querySelectorAll('.btn-primary');
                        primaryBtns.forEach(el => el.style.backgroundColor = config.primary_action_color || defaultConfig.primary_action_color);
                        
                        const secondaryBtns = document.querySelectorAll('.bg-gray-600');
                        secondaryBtns.forEach(el => el.style.backgroundColor = config.secondary_action_color || defaultConfig.secondary_action_color);
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [
                            {
                                get: () => config.background_color || defaultConfig.background_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ background_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.surface_color || defaultConfig.surface_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ surface_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.text_color || defaultConfig.text_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ text_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ primary_action_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ secondary_action_color: value });
                                    }
                                }
                            }
                        ],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["sistema_titulo", config.sistema_titulo || defaultConfig.sistema_titulo],
                        ["hospital_nome", config.hospital_nome || defaultConfig.hospital_nome]
                    ])
                });
            }

            setupEventListeners();
        }

        // Event Listeners
        function setupEventListeners() {
            // Login
            loginForm.addEventListener('submit', handleLogin);
            
            // Logout
            logoutBtn.addEventListener('click', handleLogout);
            
            // Adicionar material
            addMaterialBtn.addEventListener('click', () => openMaterialModal());
            
            // Filtros
            filterBtn.addEventListener('click', toggleFilterPanel);
            document.getElementById('applyFiltersBtn').addEventListener('click', applyFilters);
            document.getElementById('clearFiltersBtn').addEventListener('click', clearFilters);
            
            // Modal de material
            document.getElementById('closeModalBtn').addEventListener('click', closeMaterialModal);
            document.getElementById('cancelBtn').addEventListener('click', closeMaterialModal);
            materialForm.addEventListener('submit', handleSaveMaterial);
            
            // Modal de exclusão
            document.getElementById('cancelDeleteBtn').addEventListener('click', closeDeleteModal);
            document.getElementById('confirmDeleteBtn').addEventListener('click', handleDeleteMaterial);
            
            // Fechar modais clicando fora
            materialModal.addEventListener('click', (e) => {
                if (e.target === materialModal) closeMaterialModal();
            });
            deleteModal.addEventListener('click', (e) => {
                if (e.target === deleteModal) closeDeleteModal();
            });
        }

        // Funções de Login/Logout
        function handleLogin(e) {
            e.preventDefault();
            const nome = nomeUsuarioInput.value.trim();
            if (nome) {
                currentUser = nome;
                currentUserSpan.textContent = nome;
                loginScreen.classList.add('hidden');
                mainSystem.classList.remove('hidden');
                mainSystem.classList.add('fade-in');
            }
        }

        function handleLogout() {
            currentUser = '';
            loginScreen.classList.remove('hidden');
            mainSystem.classList.add('hidden');
            nomeUsuarioInput.value = '';
        }

        // Funções de Material
        function openMaterialModal(material = null) {
            editingMaterial = material;
            const modalTitle = document.getElementById('modalTitle');
            const saveBtnText = document.getElementById('saveBtnText');
            
            if (material) {
                modalTitle.textContent = 'Editar Material';
                saveBtnText.textContent = 'Atualizar Material';
                fillMaterialForm(material);
            } else {
                modalTitle.textContent = 'Adicionar Material';
                saveBtnText.textContent = 'Salvar Material';
                materialForm.reset();
            }
            
            materialModal.classList.remove('hidden');
        }

        function closeMaterialModal() {
            materialModal.classList.add('hidden');
            editingMaterial = null;
            materialForm.reset();
        }

        function fillMaterialForm(material) {
            document.getElementById('nomeMaterial').value = material.nome_material;
            document.getElementById('categoria').value = material.categoria;
            document.getElementById('quantidade').value = material.quantidade;
            document.getElementById('fabricante').value = material.fabricante || '';
            document.getElementById('dataFabricacao').value = material.data_fabricacao || '';
            document.getElementById('dataValidade').value = material.data_validade;
        }

        async function handleSaveMaterial(e) {
            e.preventDefault();
            
            const saveBtnText = document.getElementById('saveBtnText');
            const saveBtnLoading = document.getElementById('saveBtnLoading');
            
            saveBtnText.classList.add('hidden');
            saveBtnLoading.classList.remove('hidden');
            
            const formData = new FormData(materialForm);
            const materialData = {
                id: editingMaterial ? editingMaterial.id : Date.now().toString(),
                nome_material: formData.get('nomeMaterial') || document.getElementById('nomeMaterial').value,
                categoria: formData.get('categoria') || document.getElementById('categoria').value,
                quantidade: parseInt(formData.get('quantidade') || document.getElementById('quantidade').value),
                fabricante: formData.get('fabricante') || document.getElementById('fabricante').value,
                data_fabricacao: formData.get('dataFabricacao') || document.getElementById('dataFabricacao').value,
                data_validade: formData.get('dataValidade') || document.getElementById('dataValidade').value,
                usuario_alteracao: currentUser,
                data_alteracao: new Date().toISOString()
            };

            let result;
            if (editingMaterial) {
                materialData.__backendId = editingMaterial.__backendId;
                result = await window.dataSdk.update(materialData);
            } else {
                if (materials.length >= 999) {
                    showToast('Limite máximo de 999 materiais atingido. Exclua alguns materiais primeiro.', 'error');
                    saveBtnText.classList.remove('hidden');
                    saveBtnLoading.classList.add('hidden');
                    return;
                }
                result = await window.dataSdk.create(materialData);
            }

            if (result.isOk) {
                closeMaterialModal();
                showToast(editingMaterial ? 'Material atualizado com sucesso!' : 'Material adicionado com sucesso!', 'success');
            } else {
                showToast('Erro ao salvar material. Tente novamente.', 'error');
            }
            
            saveBtnText.classList.remove('hidden');
            saveBtnLoading.classList.add('hidden');
        }

        // Funções de Exclusão
        function openDeleteModal(material) {
            materialToDelete = material;
            deleteModal.classList.remove('hidden');
        }

        function closeDeleteModal() {
            deleteModal.classList.add('hidden');
            materialToDelete = null;
        }

        async function handleDeleteMaterial() {
            if (!materialToDelete) return;
            
            const deleteBtnText = document.getElementById('deleteBtnText');
            const deleteBtnLoading = document.getElementById('deleteBtnLoading');
            
            deleteBtnText.classList.add('hidden');
            deleteBtnLoading.classList.remove('hidden');
            
            const result = await window.dataSdk.delete(materialToDelete);
            
            if (result.isOk) {
                closeDeleteModal();
                showToast('Material excluído com sucesso!', 'success');
            } else {
                showToast('Erro ao excluir material. Tente novamente.', 'error');
            }
            
            deleteBtnText.classList.remove('hidden');
            deleteBtnLoading.classList.add('hidden');
        }

        // Funções de Filtro
        function toggleFilterPanel() {
            filterPanel.classList.toggle('hidden');
        }

        function updateCategoriesFilter() {
            const filterCategoria = document.getElementById('filterCategoria');
            const categories = [...new Set(materials.map(m => m.categoria))].sort();
            
            // Limpar opções existentes (exceto "Todas as categorias")
            while (filterCategoria.children.length > 1) {
                filterCategoria.removeChild(filterCategoria.lastChild);
            }
            
            // Adicionar categorias
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                filterCategoria.appendChild(option);
            });
        }

        function applyFilters() {
            const filterCategoria = document.getElementById('filterCategoria').value;
            const filterStatus = document.getElementById('filterStatus').value;
            const filterNome = document.getElementById('filterNome').value.toLowerCase();
            
            filteredMaterials = materials.filter(material => {
                const matchCategoria = !filterCategoria || material.categoria === filterCategoria;
                const matchNome = !filterNome || material.nome_material.toLowerCase().includes(filterNome);
                const matchStatus = !filterStatus || getValidityStatus(material.data_validade) === filterStatus;
                
                return matchCategoria && matchNome && matchStatus;
            });
            
            renderMaterials();
            updateMaterialsCount();
        }

        function clearFilters() {
            document.getElementById('filterCategoria').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterNome').value = '';
            filteredMaterials = [...materials];
            renderMaterials();
            updateMaterialsCount();
        }

        // Funções de Renderização
        function renderMaterials() {
            if (filteredMaterials.length === 0) {
                emptyState.classList.remove('hidden');
                materialsContainer.innerHTML = '';
                materialsContainer.appendChild(emptyState);
                return;
            }
            
            emptyState.classList.add('hidden');
            
            // Ordenar por data de validade (mais próximos do vencimento primeiro)
            const sortedMaterials = [...filteredMaterials].sort((a, b) => {
                return new Date(a.data_validade) - new Date(b.data_validade);
            });
            
            materialsContainer.innerHTML = sortedMaterials.map(material => {
                const validityStatus = getValidityStatus(material.data_validade);
                const statusClass = `status-${validityStatus}`;
                const statusText = getValidityStatusText(validityStatus);
                
                return `
                    <div class="px-6 py-4 hover:bg-gray-50 transition-colors">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h3 class="text-lg font-medium text-gray-900">${material.nome_material}</h3>
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${statusClass}">${statusText}</span>
                                </div>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600">
                                    <div>
                                        <span class="font-medium">Categoria:</span> ${material.categoria}
                                    </div>
                                    <div>
                                        <span class="font-medium">Quantidade:</span> ${material.quantidade}
                                    </div>
                                    <div>
                                        <span class="font-medium">Validade:</span> ${formatDate(material.data_validade)}
                                    </div>
                                    <div>
                                        <span class="font-medium">Fabricante:</span> ${material.fabricante || 'N/A'}
                                    </div>
                                </div>
                                <div class="mt-2 text-xs text-gray-500">
                                    Última alteração: ${material.usuario_alteracao} em ${formatDateTime(material.data_alteracao)}
                                </div>
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="openMaterialModal(${JSON.stringify(material).replace(/"/g, '&quot;')})" 
                                        class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                                    Editar
                                </button>
                                <button onclick="openDeleteModal(${JSON.stringify(material).replace(/"/g, '&quot;')})" 
                                        class="text-red-600 hover:text-red-800 font-medium text-sm">
                                    Excluir
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMaterialsCount() {
            const count = filteredMaterials.length;
            materialsCount.textContent = `${count} ${count === 1 ? 'material encontrado' : 'materiais encontrados'}`;
        }

        // Funções Utilitárias
        function getValidityStatus(dataValidade) {
            const today = new Date();
            const validity = new Date(dataValidade);
            const diffTime = validity - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) return 'vencido';
            if (diffDays <= 30) return 'vencendo';
            return 'ok';
        }

        function getValidityStatusText(status) {
            switch (status) {
                case 'vencido': return 'Vencido';
                case 'vencendo': return 'Vencendo';
                case 'ok': return 'Válido';
                default: return 'Válido';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleDateString('pt-BR');
        }

        function formatDateTime(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleString('pt-BR');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 'bg-blue-600'
            }`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Inicializar aplicação
        init();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a09d853d5b080fe',t:'MTc2MzQ5MzgzNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>